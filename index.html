<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anaconda Sales Intelligence Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        // Icons
        const Upload = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>);
        const Award = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>);
        const BarChart = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>);
        const Star = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>);
        const Target = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>);
        const ThumbsDown = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/></svg>);
        const Clock = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>);
        const ChevronDown = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>);
        const ChevronUp = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="18 15 12 9 6 15"/></svg>);
        const Info = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>);
        const Users = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);

        const AnacondaSalesIntelligence = () => {
            const [data, setData] = useState(null);
            const [analysis, setAnalysis] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [expandedCall, setExpandedCall] = useState(null);
            const [activeView, setActiveView] = useState('overview');

            const valueSellingPatterns = {
                discovery: { keywords: ['what does it cost', 'how much time', 'how many', 'what keeps you up', 'walk me through', 'help me understand', 'how long does it take', 'tell me about'], weight: 5, name: 'Discovery & Pain', explanation: 'Questions that uncover customer pain points and quantify problems' },
                quantified_impact: { keywords: ['reduction', 'efficiency', 'roi', 'npv', 'cost avoidance', 'cost savings', 'fte savings', 'save'], weight: 5, name: 'Quantified Impact', explanation: 'Specific numbers showing business value' },
                time_to_value: { keywords: ['weeks instead of months', 'pilot to production', 'time to market', 'faster time', 'quickly', 'expedite', 'timeline', 'deadline'], weight: 4, name: 'Time-to-Value', explanation: 'Discussion of speed and acceleration' },
                customer_pain: { keywords: ['problem', 'issue', 'challenge', 'difficulty', 'bottleneck', 'wild west', 'shadow it', 'pilot purgatory', 'stuck in pilot'], weight: 4, name: 'Customer Pain', explanation: 'Specific customer challenges mentioned' },
                problem_to_solution: { keywords: ['eliminate bottleneck', 'gatekeepers to enablers', 'solution', 'help', 'support', 'resolve'], weight: 4, name: 'Problem to Solution', explanation: 'Connecting problems to solutions' },
                strategic_value: { keywords: ['strategic', 'digital transformation', 'competitive advantage', 'market leadership', 'innovation', 'business case', 'investment'], weight: 3, name: 'Strategic Value', explanation: 'Executive-level strategic value' },
                outcome_questions: { keywords: ['what would it mean', 'what could you do', 'what would you build', 'what is the risk', 'what if this continues'], weight: 4, name: 'Outcome Questions', explanation: 'Forward-looking questions about outcomes' },
                value_connection: { keywords: ['which means you can', 'so you can', 'enabling you to', 'translates to', 'results in', 'business impact'], weight: 3, name: 'Value Translation', explanation: 'Bridging features to business value' }
            };

            const negativePatterns = {
                feature_selling: { keywords: ['just use', 'simply use', 'just install', 'conda-forge alone', 'community repositories'], weight: -3, name: 'Feature Selling', explanation: 'Leading with features instead of value' },
                compliance_selling: { keywords: ['out of compliance', 'you need to buy', 'mandatory', 'license violation', 'terms of service', 'forced to upgrade'], weight: -5, name: 'Compliance Selling', explanation: 'Using fear/compliance as motivator' }
            };

            const maturityExplanations = {
                'Master': { description: 'Excellent value-based selling with multiple discovery questions, quantified business impact, and customer-focused language', color: 'text-green-600', icon: 'üåü' },
                'Proficient': { description: 'Good value selling with some discovery and business impact discussion, room for improvement', color: 'text-blue-600', icon: '‚úì' },
                'Developing': { description: 'Starting to use value language but missing key elements like discovery questions or quantified impact', color: 'text-yellow-600', icon: '‚ö°' },
                'Transactional': { description: 'Product/feature focused conversation with minimal value discussion. Needs more discovery, pain identification, and business impact.', color: 'text-gray-600', icon: '‚óã' },
                'Needs Coaching': { description: 'Red flags detected: Leading with compliance/fear or heavy feature dumping without value context. Requires immediate coaching.', color: 'text-red-600', icon: '‚ö†Ô∏è' }
            };

            const analyzeText = (text) => {
                const textLower = (text || '').toLowerCase();
                const results = {};
                
                Object.entries(valueSellingPatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    pattern.keywords.forEach(keyword => {
                        if (textLower.includes(keyword)) count++;
                    });
                    results[key] = { name: pattern.name, count, score: count * pattern.weight, weight: pattern.weight, explanation: pattern.explanation };
                });

                Object.entries(negativePatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    pattern.keywords.forEach(keyword => {
                        if (textLower.includes(keyword)) count++;
                    });
                    results[key] = { name: pattern.name, count, score: count * pattern.weight, weight: pattern.weight, isNegative: true, explanation: pattern.explanation };
                });

                const totalScore = Object.values(results).reduce((sum, r) => sum + r.score, 0);
                const positiveScore = Object.entries(results).filter(([key]) => !negativePatterns[key]).reduce((sum, [_, r]) => sum + r.score, 0);
                const negativeScore = Object.entries(results).filter(([key]) => negativePatterns[key]).reduce((sum, [_, r]) => sum + Math.abs(r.score), 0);

                let maturity = 'Transactional';
                if (totalScore >= 8 && negativeScore === 0) maturity = 'Master';
                else if (totalScore >= 5 && negativeScore <= 3) maturity = 'Proficient';
                else if (totalScore >= 3) maturity = 'Developing';
                else if (negativeScore > positiveScore) maturity = 'Needs Coaching';

                return { patterns: results, totalScore, positiveScore, negativeScore, maturity, isHighValue: totalScore >= 5, hasNegativePatterns: negativeScore > 0 };
            };

            const generateCoachingInsights = (valueSelling) => {
                const insights = [];
                const maturity = valueSelling.maturity;
                
                if (maturity === 'Needs Coaching') {
                    if (valueSelling.hasNegativePatterns) {
                        insights.push('üö® RED FLAG: Detected compliance/feature selling. Rep is leading with "you must buy" or technical features instead of discovering business value.');
                    }
                    insights.push('Focus coaching on: Discovery questions, understanding customer pain, and quantifying business impact.');
                } else if (maturity === 'Transactional') {
                    if (valueSelling.patterns.discovery?.count === 0) {
                        insights.push('MISSING: No discovery questions detected. Rep should ask "What does that cost you?" or "How much time does that take?"');
                    }
                    if (valueSelling.patterns.quantified_impact?.count === 0) {
                        insights.push('MISSING: No quantified business impact. Rep should reference ROI, cost savings, or efficiency gains.');
                    }
                } else if (maturity === 'Developing') {
                    insights.push('GOOD START: Some value patterns present, but needs more depth and consistency.');
                } else if (maturity === 'Proficient') {
                    insights.push('STRONG: Good value-based selling. Continue reinforcing these behaviors.');
                } else if (maturity === 'Master') {
                    insights.push('üåü EXEMPLAR: Excellent value-based selling. Use this call as a training example.');
                }
                
                return insights;
            };

            const extractClariTopics = (row) => {
                const topics = [];
                const topicColumns = [
                    'Competition (Topic)', 'Customer Goals Pain Points (Topic)', 'NEXT STEPS - AI DETECTED (Topic)',
                    'Agenda Setting (Topic)', 'PRICING - AI DETECTED (Topic)', 'Authority (Topic)',
                    'Budget (Topic)', 'Timing (Topic)', 'Process (Topic)'
                ];
                
                topicColumns.forEach(col => {
                    if (row[col] && row[col] > 0) {
                        const topicName = col.replace(' (Topic)', '').replace('NEXT STEPS - AI DETECTED', 'Next Steps').replace('PRICING - AI DETECTED', 'Pricing');
                        topics.push({ name: topicName, score: row[col] });
                    }
                });
                
                return topics.sort((a, b) => b.score - a.score);
            };

            const getStageProgression = (before, after) => {
                if (!before || !after || before === after) return 'No Change';
                const stages = ['Discovery', 'Qualification', 'Proposal', 'Negotiation', 'Closed Won', 'Closed Lost'];
                const beforeIdx = stages.findIndex(s => before.includes(s));
                const afterIdx = stages.findIndex(s => after.includes(s));
                if (beforeIdx < afterIdx && !after.includes('Lost')) return 'Advanced';
                if (beforeIdx > afterIdx || after.includes('Lost')) return 'Regressed';
                return 'Changed';
            };

            const handleFileUpload = async (event) => {
                const files = Array.from(event.target.files);
                if (files.length === 0) return;

                setLoading(true);
                setError(null);

                try {
                    const firstFile = files[0];
                    const fileName = firstFile.name.toLowerCase();

                    if (fileName.endsWith('.csv')) {
                        const text = await firstFile.text();
                        
                        Papa.parse(text, {
                            header: true,
                            skipEmptyLines: true,
                            complete: (results) => {
                                const processed = results.data
                                    .filter(row => row['Call title'] || row['Account Name'])
                                    .map((row, idx) => {
                                        const textToAnalyze = [
                                            row['Call title'] || '',
                                            row['Account Name'] || '',
                                            row['Opportunity Name'] || ''
                                        ].join(' ');

                                        const valueSelling = analyzeText(textToAnalyze);
                                        const clariTopics = extractClariTopics(row);
                                        const coachingInsights = generateCoachingInsights(valueSelling);

                                        return {
                                            id: idx,
                                            callTitle: row['Call title'] || 'Unknown Call',
                                            account: row['Account Name'] || 'Unknown Account',
                                            repName: row['Rep Name'] || 'Unknown Rep',
                                            opportunity: row['Opportunity Name'] || '',
                                            callLink: row['Call Link'] || '',
                                            durationMinutes: Math.round((row['Duration (in Seconds)'] || 0) / 60),
                                            talkListenRatio: row['Talk/listen ratio (%)'] || 0,
                                            interactivity: row['Interactivity'] || 0,
                                            engagingQuestions: row['Engaging questions'] || 0,
                                            dealStageBefore: row['Deal Stage before Call'] || '',
                                            dealStageAfter: row['Deal Stage after Call'] || '',
                                            stageProgression: getStageProgression(row['Deal Stage before Call'], row['Deal Stage after Call']),
                                            attendees: row['Joined Attendees'] || '',
                                            valueSelling,
                                            clariTopics,
                                            coachingInsights,
                                            type: 'csv'
                                        };
                                    });

                                if (processed.length === 0) {
                                    setError('No valid data found in CSV.');
                                    setLoading(false);
                                    return;
                                }

                                setData(processed);
                                setTimeout(() => {
                                    generateAnalysis(processed);
                                    setLoading(false);
                                }, 100);
                            },
                            error: (error) => {
                                setError('Error parsing CSV: ' + error.message);
                                setLoading(false);
                            }
                        });
                    }
                } catch (err) {
                    setError('Error reading file: ' + err.message);
                    setLoading(false);
                }
            };

            const generateAnalysis = (records) => {
                const total = records.length;
                const avgScore = records.reduce((sum, r) => sum + r.valueSelling.totalScore, 0) / total;
                const avgEngagement = records.reduce((sum, r) => sum + (r.engagingQuestions || 0), 0) / total;
                
                const maturityDist = {};
                records.forEach(r => {
                    maturityDist[r.valueSelling.maturity] = (maturityDist[r.valueSelling.maturity] || 0) + 1;
                });

                setAnalysis({
                    overview: {
                        total,
                        avgScore: Math.round(avgScore),
                        avgEngagement: Math.round(avgEngagement),
                        masterCallsCount: records.filter(r => r.valueSelling.maturity === 'Master').length,
                        highValueCount: records.filter(r => r.valueSelling.isHighValue).length,
                        needsCoachingCount: records.filter(r => r.valueSelling.maturity === 'Needs Coaching').length
                    },
                    maturityDistribution: maturityDist,
                    topPerformers: [...records].sort((a, b) => b.valueSelling.totalScore - a.valueSelling.totalScore).slice(0, 20)
                });
            };

            const getMaturityColor = (maturity) => {
                switch(maturity) {
                    case 'Master': return 'bg-green-100 text-green-800 border-green-300';
                    case 'Proficient': return 'bg-blue-100 text-blue-800 border-blue-300';
                    case 'Developing': return 'bg-yellow-100 text-yellow-800 border-yellow-300';
                    case 'Needs Coaching': return 'bg-red-100 text-red-800 border-red-300';
                    default: return 'bg-gray-100 text-gray-800 border-gray-300';
                }
            };

            if (!data || !analysis) {
                return (
                    <div className="min-h-screen bg-gray-50 p-8">
                        <div className="max-w-7xl mx-auto">
                            <div className="bg-white rounded-lg shadow-lg p-8">
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-8 h-8 text-blue-600"><Award /></div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-900">Anaconda Sales Intelligence</h1>
                                        <p className="text-gray-600">Upload Clari CSV or call transcripts</p>
                                    </div>
                                </div>

                                {error && (
                                    <div className="mb-4 p-4 bg-red-50 border-l-4 border-red-500 rounded">
                                        <p className="text-sm font-semibold text-red-800">Error:</p>
                                        <p className="text-sm text-red-700">{error}</p>
                                    </div>
                                )}

                                <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer">
                                    <input type="file" accept=".csv,.txt" multiple onChange={handleFileUpload} className="hidden" id="file-upload" />
                                    <label htmlFor="file-upload" className="cursor-pointer">
                                        <div className="w-16 h-16 text-gray-400 mx-auto mb-4"><Upload /></div>
                                        <p className="text-xl font-medium text-gray-700 mb-2">Upload Files</p>
                                        <p className="text-sm text-gray-500">CSV (Clari) or TXT (transcripts)</p>
                                    </label>
                                </div>

                                {loading && (
                                    <div className="mt-8 text-center">
                                        <div className="animate-pulse">
                                            <div className="w-12 h-12 text-blue-600 mx-auto mb-4"><BarChart /></div>
                                            <p className="text-gray-600">Analyzing calls...</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            const CallCard = ({ call, index }) => {
                const isExpanded = expandedCall === index;
                const maturityInfo = maturityExplanations[call.valueSelling.maturity];

                return (
                    <div className="border-2 border-blue-200 rounded-lg p-4 bg-white mb-3">
                        <div className="flex justify-between items-start mb-2">
                            <div className="flex-1">
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="text-lg font-bold text-blue-600">#{index + 1}</span>
                                    <p className="font-semibold text-gray-900">{call.account}</p>
                                </div>
                                <p className="text-sm text-gray-600">{call.callTitle}</p>
                                <p className="text-xs text-gray-500">Rep: {call.repName}</p>
                            </div>
                            <div className="text-right">
                                <span className="text-2xl font-bold text-green-600">{call.valueSelling.totalScore}</span>
                                <p className="text-xs text-gray-600">score</p>
                            </div>
                        </div>

                        <div className="flex items-center gap-2 mb-3 flex-wrap">
                            <span className={`px-3 py-1 rounded-full text-xs font-medium ${getMaturityColor(call.valueSelling.maturity)}`}>
                                {maturityInfo.icon} {call.valueSelling.maturity}
                            </span>
                            {call.valueSelling.isHighValue && (
                                <span className="px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">High-Value</span>
                            )}
                            {call.durationMinutes > 0 && (
                                <span className="px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <Clock className="w-3 h-3 inline mr-1" />{call.durationMinutes} min
                                </span>
                            )}
                            {call.stageProgression && call.stageProgression !== 'No Change' && (
                                <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                                    call.stageProgression === 'Advanced' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                }`}>{call.stageProgression}</span>
                            )}
                        </div>

                        <div className="mb-3 p-3 bg-blue-50 rounded">
                            <p className={`text-xs font-semibold ${maturityInfo.color} mb-1`}>
                                <Info className="w-3 h-3 inline mr-1" />What "{call.valueSelling.maturity}" means:
                            </p>
                            <p className="text-xs text-gray-700">{maturityInfo.description}</p>
                        </div>

                        <button onClick={() => setExpandedCall(isExpanded ? null : index)} className="w-full text-left p-3 bg-blue-50 rounded hover:bg-blue-100 transition-colors">
                            <div className="flex items-center justify-between">
                                <span className="text-sm font-medium text-blue-900">üìã Call Summary</span>
                                {isExpanded ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />}
                            </div>
                        </button>

                        {isExpanded && (
                            <div className="mt-3 p-4 bg-gray-50 rounded space-y-4">
                                {call.coachingInsights && call.coachingInsights.length > 0 && (
                                    <div className="p-3 bg-yellow-50 rounded border-l-4 border-yellow-500">
                                        <p className="text-xs font-semibold text-yellow-900 mb-2">üí° COACHING INSIGHTS:</p>
                                        {call.coachingInsights.map((insight, i) => (
                                            <p key={i} className="text-sm text-gray-900 mb-1">‚Ä¢ {insight}</p>
                                        ))}
                                    </div>
                                )}

                                {call.clariTopics && call.clariTopics.length > 0 && (
                                    <div>
                                        <p className="text-xs font-semibold text-gray-700 mb-2">ü§ñ Clari AI Topics:</p>
                                        <div className="flex flex-wrap gap-1">
                                            {call.clariTopics.map((topic, i) => (
                                                <span key={i} className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">
                                                    {topic.name} ({topic.score})
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {(call.dealStageBefore || call.dealStageAfter) && (
                                    <div>
                                        <p className="text-xs font-semibold text-gray-700 mb-1">üìà Deal Progression:</p>
                                        <p className="text-sm text-gray-900">
                                            {call.dealStageBefore === call.dealStageAfter 
                                                ? `Deal remained in ${call.dealStageAfter} stage`
                                                : `${call.dealStageBefore} ‚Üí ${call.dealStageAfter}`
                                            }
                                        </p>
                                    </div>
                                )}

                                {(call.talkListenRatio > 0 || call.engagingQuestions > 0) && (
                                    <div>
                                        <p className="text-xs font-semibold text-gray-700 mb-1">üí¨ Engagement:</p>
                                        <p className="text-sm text-gray-900">
                                            {call.engagingQuestions > 0 && `${call.engagingQuestions} questions asked ‚Ä¢ `}
                                            {call.talkListenRatio > 0 && `${call.talkListenRatio}% talk/listen ratio`}
                                        </p>
                                    </div>
                                )}

                                {call.attendees && (
                                    <div>
                                        <p className="text-xs font-semibold text-gray-700 mb-1">üë• Attendees:</p>
                                        <p className="text-xs text-gray-600">{call.attendees}</p>
                                    </div>
                                )}

                                <div>
                                    <p className="text-xs font-semibold text-gray-700 mb-2">‚ú® Value Patterns Detected:</p>
                                    <div className="space-y-1">
                                        {Object.entries(call.valueSelling.patterns)
                                            .filter(([_, p]) => p.count > 0)
                                            .map(([key, p]) => (
                                                <div key={key} className={`p-2 rounded ${p.isNegative ? 'bg-red-50' : 'bg-green-50'}`}>
                                                    <div className="flex justify-between items-start">
                                                        <span className={`text-xs font-medium ${p.isNegative ? 'text-red-800' : 'text-green-800'}`}>
                                                            {p.isNegative ? '‚ö†Ô∏è' : '‚úì'} {p.name} ({p.count})
                                                        </span>
                                                        <span className={`text-xs ${p.isNegative ? 'text-red-600' : 'text-green-600'}`}>
                                                            {p.score > 0 ? '+' : ''}{p.score} pts
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                    </div>
                                </div>

                                {call.callLink && (
                                    <a href={call.callLink} target="_blank" rel="noopener noreferrer" className="text-sm text-blue-600 hover:underline font-medium">
                                        üé• View recording
                                    </a>
                                )}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-50 p-8">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 text-blue-600"><Award /></div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-900">Anaconda Sales Intelligence</h1>
                                        <p className="text-sm text-gray-600">{data.length} calls ‚Ä¢ Avg Score: <span className="font-bold text-blue-600">{analysis.overview.avgScore}</span></p>
                                    </div>
                                </div>
                                <button onClick={() => { setData(null); setAnalysis(null); setError(null); }} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium">Upload New</button>
                            </div>
                        </div>

                        <div className="grid grid-cols-4 gap-6 mb-6">
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-green-600"><Star /></div>
                                    <span className="text-sm text-gray-600">Master Calls</span>
                                </div>
                                <p className="text-3xl font-bold text-gray-900">{analysis.overview.masterCallsCount}</p>
                                <p className="text-xs text-gray-500 mt-1">{((analysis.overview.masterCallsCount / analysis.overview.total) * 100).toFixed(1)}%</p>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-purple-600"><Target /></div>
                                    <span className="text-sm text-gray-600">High-Value</span>
                                </div>
                                <p className="text-3xl font-bold text-gray-900">{analysis.overview.highValueCount}</p>
                                <p className="text-xs text-gray-500 mt-1">{((analysis.overview.highValueCount / analysis.overview.total) * 100).toFixed(1)}%</p>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-red-600"><ThumbsDown /></div>
                                    <span className="text-sm text-gray-600">Needs Coaching</span>
                                </div>
                                <p className="text-3xl font-bold text-gray-900">{analysis.overview.needsCoachingCount}</p>
                                <p className="text-xs text-gray-500 mt-1">{((analysis.overview.needsCoachingCount / analysis.overview.total) * 100).toFixed(1)}%</p>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-blue-600"><Users /></div>
                                    <span className="text-sm text-gray-600">Engagement</span>
                                </div>
                                <p className="text-3xl font-bold text-gray-900">{analysis.overview.avgEngagement}</p>
                                <p className="text-xs text-gray-500 mt-1">avg questions</p>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow mb-6 p-2">
                            <div className="flex gap-2">
                                {['overview', 'allCalls', 'topCalls'].map(view => (
                                    <button key={view} onClick={() => setActiveView(view)} className={`px-4 py-2 rounded capitalize ${activeView === view ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}`}>
                                        {view === 'allCalls' ? 'All Calls' : view === 'topCalls' ? 'Top Calls' : 'Overview'}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {activeView === 'overview' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Maturity Distribution</h3>
                                <div className="grid grid-cols-5 gap-4">
                                    {Object.entries(analysis.maturityDistribution).map(([maturity, count]) => {
                                        const info = maturityExplanations[maturity];
                                        return (
                                            <div key={maturity} className={`rounded-lg p-4 border-2 ${getMaturityColor(maturity)}`}>
                                                <p className="text-sm font-medium mb-1">{info.icon} {maturity}</p>
                                                <p className="text-3xl font-bold">{count}</p>
                                                <p className="text-xs mt-1">{((count / analysis.overview.total) * 100).toFixed(1)}%</p>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {activeView === 'allCalls' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">All Calls with Summaries</h3>
                                <div className="space-y-2">
                                    {data.map((call, idx) => <CallCard key={idx} call={call} index={idx} />)}
                                </div>
                            </div>
                        )}

                        {activeView === 'topCalls' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Top 20 Calls</h3>
                                <div className="space-y-2">
                                    {analysis.topPerformers.map((call, idx) => <CallCard key={idx} call={call} index={idx} />)}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<AnacondaSalesIntelligence />, document.getElementById('root'));
    </script>
</body>
</html>