<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anaconda Sales Intelligence Dashboard</title>
    <meta http-equiv="Cache-Control" content="no-cache">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState } = React;
const Upload = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>);
const Award = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>);
const BarChart = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>);
const Star = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>);
const Target = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>);
const ThumbsDown = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 01-1.92-2.56l2.33-8A2 2 0 016.5 2H20a2 2 0 012 2v8a2 2 0 01-2 2h-2.76a2 2 0 00-1.79 1.11L12 22a3.13 3.13 0 01-3-3.88Z"/></svg>);
const Clock = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>);
const ChevronDown = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>);
const ChevronUp = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="18 15 12 9 6 15"/></svg>);
const Info = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>);

const App = () => {
const [data, setData] = useState(null);
const [analysis, setAnalysis] = useState(null);
const [loading, setLoading] = useState(false);
const [error, setError] = useState(null);
const [expandedCall, setExpandedCall] = useState(null);
const [activeView, setActiveView] = useState('overview');

const patterns = {
discovery: { kw: ['what does it cost', 'how much time', 'how many', 'help me understand'], w: 5, n: 'Discovery & Pain' },
impact: { kw: ['roi', 'efficiency', 'cost savings', 'save'], w: 5, n: 'Quantified Impact' },
pain: { kw: ['problem', 'issue', 'challenge', 'bottleneck'], w: 4, n: 'Customer Pain' }
};

const analyze = (txt) => {
const t = (txt || '').toLowerCase();
let score = 0;
const found = {};
Object.entries(patterns).forEach(([k, p]) => {
let ct = 0;
p.kw.forEach(kw => { if (t.includes(kw)) ct++; });
if (ct > 0) { score += ct * p.w; found[k] = { name: p.n, count: ct, score: ct * p.w }; }
});
let mat = 'Transactional';
if (score >= 8) mat = 'Master';
else if (score >= 5) mat = 'Proficient';
else if (score >= 3) mat = 'Developing';
return { totalScore: score, maturity: mat, patterns: found };
};

const getTopics = (row) => {
const topics = [];
['Competition (Topic)', 'Customer Goals Pain Points (Topic)', 'NEXT STEPS - AI DETECTED (Topic)', 'Process (Topic)', 'PRICING - AI DETECTED (Topic)', 'Timing (Topic)'].forEach(col => {
if (row[col] && row[col] > 0) {
const name = col.replace(' (Topic)', '').replace('NEXT STEPS - AI DETECTED', 'Next Steps').replace('PRICING - AI DETECTED', 'Pricing');
topics.push({ name, score: row[col] });
}
});
return topics.sort((a, b) => b.score - a.score);
};

const handleUpload = async (e) => {
const file = e.target.files[0];
if (!file) return;
setLoading(true);
setError(null);
try {
const txt = await file.text();
Papa.parse(txt, {
header: true,
skipEmptyLines: true,
complete: (r) => {
const proc = r.data.filter(row => row['Call title'] || row['Account Name']).map((row, i) => {
const vs = analyze([row['Call title'] || '', row['Account Name'] || ''].join(' '));
return {
id: i,
callTitle: row['Call title'] || 'Unknown',
account: row['Account Name'] || 'Unknown',
repName: row['Rep Name'] || 'Unknown',
callLink: row['Call Link'] || '',
durationMinutes: Math.round((row['Duration (in Seconds)'] || 0) / 60),
talkListenRatio: row['Talk/listen ratio (%)'] || 0,
engagingQuestions: row['Engaging questions'] || 0,
dealStageBefore: row['Deal Stage before Call'] || '',
dealStageAfter: row['Deal Stage after Call'] || '',
attendees: row['Joined Attendees'] || '',
valueSelling: vs,
clariTopics: getTopics(row)
};
});
setData(proc);
const tot = proc.length;
const avg = proc.reduce((s, r) => s + r.valueSelling.totalScore, 0) / tot;
const md = {};
proc.forEach(r => { md[r.valueSelling.maturity] = (md[r.valueSelling.maturity] || 0) + 1; });
setAnalysis({
overview: { total: tot, avgScore: Math.round(avg), masterCallsCount: proc.filter(r => r.valueSelling.maturity === 'Master').length, highValueCount: proc.filter(r => r.valueSelling.totalScore >= 5).length, needsCoachingCount: proc.filter(r => r.valueSelling.maturity === 'Needs Coaching').length },
maturityDistribution: md,
topPerformers: [...proc].sort((a, b) => b.valueSelling.totalScore - a.valueSelling.totalScore).slice(0, 20),
repPerformance: {}
});
setLoading(false);
}
});
} catch (err) { setError('Error: ' + err.message); setLoading(false); }
};

const getColor = (m) => {
if (m === 'Master') return 'bg-green-100 text-green-800';
if (m === 'Proficient') return 'bg-blue-100 text-blue-800';
if (m === 'Developing') return 'bg-yellow-100 text-yellow-800';
if (m === 'Needs Coaching') return 'bg-red-100 text-red-800';
return 'bg-gray-100 text-gray-800';
};

if (!data) {
return (
<div className="min-h-screen bg-gray-50 p-8">
<div className="max-w-7xl mx-auto">
<div className="bg-white rounded-lg shadow-lg p-8">
<div className="flex items-center gap-3 mb-6">
<div className="w-8 h-8 text-blue-600"><Award /></div>
<div><h1 className="text-3xl font-bold text-gray-900">Anaconda Sales Intelligence</h1>
<p className="text-gray-600">Upload Clari CSV</p></div>
</div>
{error && <div className="mb-4 p-4 bg-red-50 border-l-4 border-red-500 rounded"><p className="text-sm text-red-800">{error}</p></div>}
<div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 cursor-pointer">
<input type="file" accept=".csv" onChange={handleUpload} className="hidden" id="up" />
<label htmlFor="up" className="cursor-pointer">
<div className="w-16 h-16 text-gray-400 mx-auto mb-4"><Upload /></div>
<p className="text-xl font-medium text-gray-700 mb-2">Upload CSV</p>
</label>
</div>
{loading && <div className="mt-8 text-center animate-pulse"><div className="w-12 h-12 text-blue-600 mx-auto mb-4"><BarChart /></div><p className="text-gray-600">Analyzing...</p></div>}
</div>
</div>
</div>
);
}

return (
<div className="min-h-screen bg-gray-50 p-8">
<div className="max-w-7xl mx-auto">
<div className="bg-white rounded-lg shadow p-6 mb-6">
<div className="flex items-center justify-between">
<div className="flex items-center gap-3">
<div className="w-8 h-8 text-blue-600"><Award /></div>
<div><h1 className="text-2xl font-bold text-gray-900">Anaconda Sales Intelligence</h1>
<p className="text-sm text-gray-600">{data.length} calls â€¢ Avg: <span className="font-bold text-blue-600">{analysis.overview.avgScore}</span></p></div>
</div>
<button onClick={() => { setData(null); setAnalysis(null); }} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded">Upload New</button>
</div>
</div>

<div className="grid grid-cols-4 gap-6 mb-6">
<div className="bg-white rounded-lg shadow p-6">
<div className="flex items-center gap-3 mb-2"><div className="w-5 h-5 text-green-600"><Star /></div><span className="text-sm text-gray-600">Master</span></div>
<p className="text-3xl font-bold">{analysis.overview.masterCallsCount}</p>
</div>
<div className="bg-white rounded-lg shadow p-6">
<div className="flex items-center gap-3 mb-2"><div className="w-5 h-5 text-purple-600"><Target /></div><span className="text-sm text-gray-600">High-Value</span></div>
<p className="text-3xl font-bold">{analysis.overview.highValueCount}</p>
</div>
<div className="bg-white rounded-lg shadow p-6">
<div className="flex items-center gap-3 mb-2"><div className="w-5 h-5 text-red-600"><ThumbsDown /></div><span className="text-sm text-gray-600">Coaching</span></div>
<p className="text-3xl font-bold">{analysis.overview.needsCoachingCount}</p>
</div>
<div className="bg-white rounded-lg shadow p-6">
<div className="flex items-center gap-3 mb-2"><div className="w-5 h-5 text-blue-600"><BarChart /></div><span className="text-sm text-gray-600">Avg Score</span></div>
<p className="text-3xl font-bold text-blue-600">{analysis.overview.avgScore}</p>
</div>
</div>

<div className="bg-white rounded-lg shadow p-6">
<h3 className="text-lg font-semibold mb-4">All Calls</h3>
{data.map((call, i) => (
<div key={i} className="border-2 border-blue-200 rounded-lg p-4 mb-3">
<div className="flex justify-between mb-2">
<div className="flex-1">
<p className="font-semibold text-gray-900">{call.account}</p>
<p className="text-sm text-gray-600">{call.callTitle}</p>
<p className="text-xs text-gray-500">Rep: {call.repName}</p>
</div>
<div className="text-right">
<span className="text-2xl font-bold text-green-600">{call.valueSelling.totalScore}</span>
<p className="text-xs text-gray-600">score</p>
</div>
</div>
<div className="flex gap-2 mb-2">
<span className={`px-3 py-1 rounded-full text-xs ${getColor(call.valueSelling.maturity)}`}>{call.valueSelling.maturity}</span>
{call.durationMinutes > 0 && <span className="px-2 py-1 rounded-full text-xs bg-gray-100">{call.durationMinutes} min</span>}
</div>
{call.clariTopics && call.clariTopics.length > 0 && (
<div className="mt-3 p-3 bg-blue-50 rounded">
<p className="text-xs font-semibold mb-2">Topics:</p>
<div className="flex flex-wrap gap-1">
{call.clariTopics.map((t, j) => <span key={j} className="px-2 py-1 bg-blue-200 text-blue-900 rounded text-xs">{t.name} ({t.score})</span>)}
</div>
</div>
)}
{call.engagingQuestions > 0 && (
<div className="mt-2 text-xs text-gray-600">{call.engagingQuestions} questions â€¢ {call.talkListenRatio}% talk/listen</div>
)}
{call.callLink && <a href={call.callLink} target="_blank" className="text-sm text-blue-600 hover:underline mt-2 inline-block">ðŸŽ¥ View Recording</a>}
</div>
))}
</div>
</div>
</div>
);
};
ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>