<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anaconda Sales Intelligence Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const Upload = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>);
        const Award = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>);
        const BarChart = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>);
        const Star = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>);
        const Target = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>);
        const ThumbsDown = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/></svg>);
        const Clock = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>);
        const ChevronDown = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>);
        const ChevronUp = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="18 15 12 9 6 15"/></svg>);
        const Info = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>);
        const Users = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);

        const Dashboard = () => {
            const [data, setData] = useState(null);
            const [analysis, setAnalysis] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [expandedCall, setExpandedCall] = useState(null);
            const [activeView, setActiveView] = useState('overview');

            const valuePatterns = {
                discovery: { keywords: ['what does it cost', 'how much time', 'how many', 'what keeps you up', 'walk me through', 'help me understand', 'how long does it take', 'tell me about'], weight: 5, name: 'Discovery & Pain', explanation: 'Questions that uncover customer pain points' },
                quantified_impact: { keywords: ['reduction', 'efficiency', 'roi', 'npv', 'cost avoidance', 'cost savings', 'fte savings', 'save'], weight: 5, name: 'Quantified Impact', explanation: 'Specific numbers showing business value' },
                time_to_value: { keywords: ['weeks instead of months', 'pilot to production', 'time to market', 'faster time', 'quickly', 'expedite'], weight: 4, name: 'Time-to-Value', explanation: 'Discussion of speed and acceleration' },
                customer_pain: { keywords: ['approval bottleneck', 'wild west', 'shadow it', 'pilot purgatory', 'stuck in pilot', 'dependency hell', 'problem', 'issue', 'challenge'], weight: 4, name: 'Customer Pain', explanation: 'Specific customer challenges mentioned' },
                problem_to_solution: { keywords: ['eliminate bottleneck', 'gatekeepers to enablers', 'move from pilot to production', 'solution', 'help', 'resolve'], weight: 4, name: 'Problem to Solution', explanation: 'Connecting problems to solutions' },
                strategic_value: { keywords: ['strategic', 'digital transformation', 'competitive advantage', 'innovation', 'business case'], weight: 3, name: 'Strategic Value', explanation: 'Executive-level strategic value' }
            };

            const negativePatterns = {
                feature_selling: { keywords: ['just use', 'simply use', 'conda-forge alone'], weight: -3, name: 'Feature Selling', explanation: 'Leading with features instead of value' },
                compliance_selling: { keywords: ['out of compliance', 'you need to buy', 'mandatory', 'license violation'], weight: -5, name: 'Compliance Selling', explanation: 'Using fear/compliance as motivator' }
            };

            const maturityInfo = {
                'Master': { description: 'Excellent value-based selling with discovery, quantified impact, and customer focus', icon: '🌟', color: 'text-green-600' },
                'Proficient': { description: 'Good value selling with some discovery and business impact', icon: '✓', color: 'text-blue-600' },
                'Developing': { description: 'Starting to use value language but missing key elements', icon: '⚡', color: 'text-yellow-600' },
                'Transactional': { description: 'Product-focused with minimal value discussion. Needs more discovery.', icon: '○', color: 'text-gray-600' },
                'Needs Coaching': { description: 'Red flags detected: compliance/feature selling without value context', icon: '⚠️', color: 'text-red-600' }
            };

            const analyzeText = (text) => {
                const textLower = (text || '').toLowerCase();
                const results = {};
                
                // More flexible keyword matching - look for partial matches
                Object.entries(valuePatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    const found = [];
                    pattern.keywords.forEach(kw => {
                        // Use regex for more flexible matching
                        const regex = new RegExp(kw.replace(/[.*+?^${}()|[\]\\]/g, '\\            const analyzeText = (text) => {
                const textLower = (text || '').toLowerCase();
                const results = {};
                
                Object.entries(valuePatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    const found = [];
                    pattern.keywords.forEach(kw => {
                        if (textLower.includes(kw)) { count++; found.push(kw); }
                    });
                    results[key] = { ...pattern, count, score: count * pattern.weight, matchedKeywords: found };
                });

                Object.entries(negativePatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    const found = [];
                    pattern.keywords.forEach(kw => {
                        if (textLower.includes(kw)) { count++; found.push(kw); }
                    });
                    results[key] = { ...pattern, count, score: count * pattern.weight, matchedKeywords: found, isNegative: true };
                });

                const totalScore = Object.values(results).reduce((sum, r) => sum + r.score, 0);
                const negScore = Object.entries(results).filter(([k]) => negativePatterns[k]).reduce((sum, [_, r]) => sum + Math.abs(r.score), 0);
                
                let maturity = 'Transactional';
                if (totalScore >= 8 && negScore === 0) maturity = 'Master';
                else if (totalScore >= 5 && negScore <= 3) maturity = 'Proficient';
                else if (totalScore >= 3) maturity = 'Developing';
                else if (negScore > totalScore) maturity = 'Needs Coaching';

                return { patterns: results, totalScore, maturity, hasNegativePatterns: negScore > 0 };
            };'), 'gi');
                        const matches = textLower.match(regex);
                        if (matches) {
                            count += matches.length;
                            if (!found.includes(kw)) found.push(kw);
                        }
                    });
                    results[key] = { ...pattern, count, score: count * pattern.weight, matchedKeywords: found };
                });

                Object.entries(negativePatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    const found = [];
                    pattern.keywords.forEach(kw => {
                        const regex = new RegExp(kw.replace(/[.*+?^${}()|[\]\\]/g, '\\            const analyzeText = (text) => {
                const textLower = (text || '').toLowerCase();
                const results = {};
                
                Object.entries(valuePatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    const found = [];
                    pattern.keywords.forEach(kw => {
                        if (textLower.includes(kw)) { count++; found.push(kw); }
                    });
                    results[key] = { ...pattern, count, score: count * pattern.weight, matchedKeywords: found };
                });

                Object.entries(negativePatterns).forEach(([key, pattern]) => {
                    let count = 0;
                    const found = [];
                    pattern.keywords.forEach(kw => {
                        if (textLower.includes(kw)) { count++; found.push(kw); }
                    });
                    results[key] = { ...pattern, count, score: count * pattern.weight, matchedKeywords: found, isNegative: true };
                });

                const totalScore = Object.values(results).reduce((sum, r) => sum + r.score, 0);
                const negScore = Object.entries(results).filter(([k]) => negativePatterns[k]).reduce((sum, [_, r]) => sum + Math.abs(r.score), 0);
                
                let maturity = 'Transactional';
                if (totalScore >= 8 && negScore === 0) maturity = 'Master';
                else if (totalScore >= 5 && negScore <= 3) maturity = 'Proficient';
                else if (totalScore >= 3) maturity = 'Developing';
                else if (negScore > totalScore) maturity = 'Needs Coaching';

                return { patterns: results, totalScore, maturity, hasNegativePatterns: negScore > 0 };
            };'), 'gi');
                        const matches = textLower.match(regex);
                        if (matches) {
                            count += matches.length;
                            if (!found.includes(kw)) found.push(kw);
                        }
                    });
                    results[key] = { ...pattern, count, score: count * pattern.weight, matchedKeywords: found, isNegative: true };
                });

                const totalScore = Object.values(results).reduce((sum, r) => sum + r.score, 0);
                const negScore = Object.entries(results).filter(([k]) => negativePatterns[k]).reduce((sum, [_, r]) => sum + Math.abs(r.score), 0);
                
                let maturity = 'Transactional';
                if (totalScore >= 8 && negScore === 0) maturity = 'Master';
                else if (totalScore >= 5 && negScore <= 3) maturity = 'Proficient';
                else if (totalScore >= 3) maturity = 'Developing';
                else if (negScore > totalScore) maturity = 'Needs Coaching';

                console.log('Analysis for text:', text.substring(0, 100), '| Score:', totalScore, '| Maturity:', maturity);

                return { patterns: results, totalScore, maturity, hasNegativePatterns: negScore > 0 };
            };

            const getCoachingInsights = (vs, call) => {
                const insights = [];
                
                // Value-selling based insights
                if (vs.maturity === 'Needs Coaching') {
                    if (vs.hasNegativePatterns) insights.push('🚨 RED FLAG: Compliance/feature selling detected instead of value-based approach.');
                    insights.push('Focus coaching on: Discovery questions, customer pain, and quantifying business impact.');
                } else if (vs.maturity === 'Transactional' || vs.totalScore === 0) {
                    if (vs.patterns.discovery?.count === 0) insights.push('MISSING: No discovery questions. Ask "What does that cost you?" or "How much time does that take?"');
                    if (vs.patterns.quantified_impact?.count === 0) insights.push('MISSING: No quantified business impact. Reference ROI, cost savings, or efficiency gains.');
                } else if (vs.maturity === 'Developing') {
                    insights.push('GOOD START: Some value patterns present, but needs more depth.');
                } else if (vs.maturity === 'Proficient') {
                    insights.push('STRONG: Good value-based selling. Continue reinforcing these behaviors.');
                } else if (vs.maturity === 'Master') {
                    insights.push('🌟 EXEMPLAR: Excellent value-based selling. Use as training example.');
                }
                
                // Add insights based on engagement data if available
                if (call && call.engagingQuestions !== undefined) {
                    if (call.engagingQuestions < 3) {
                        insights.push(`⚠️ Low question activity (${call.engagingQuestions} questions). Increase discovery: ask about current costs, time spent on problems, business impact of issues.`);
                    } else if (call.engagingQuestions >= 8) {
                        insights.push(`✅ Excellent discovery with ${call.engagingQuestions} questions - keep this up!`);
                    }
                }
                
                if (call && call.talkListenRatio !== undefined) {
                    if (call.talkListenRatio > 70) {
                        insights.push(`⚠️ Rep talked ${call.talkListenRatio}% of the time - ask more questions and let customer share their challenges.`);
                    }
                }
                
                if (call && call.stageProgression === 'Regressed') {
                    insights.push('⚠️ Deal moved backward - follow up immediately to understand concerns and re-establish value alignment.');
                }
                
                return insights;
            };

            const getTopics = (row) => {
                const topics = [];
                const cols = ['Competition (Topic)', 'Customer Goals Pain Points (Topic)', 'NEXT STEPS - AI DETECTED (Topic)', 'Process (Topic)', 'PRICING - AI DETECTED (Topic)', 'Timing (Topic)'];
                cols.forEach(col => {
                    if (row[col] && row[col] > 0) {
                        const name = col.replace(' (Topic)', '').replace('NEXT STEPS - AI DETECTED', 'Next Steps').replace('PRICING - AI DETECTED', 'Pricing');
                        topics.push({ name, score: row[col] });
                    }
                });
                return topics.sort((a, b) => b.score - a.score);
            };

            const getSummary = (call) => {
                const topics = call.clariTopics || [];
                const topicNames = topics.map(t => t.name);
                
                // Build detailed narrative summary
                let summary = '';
                
                // Opening context
                const attendeeList = call.attendees ? call.attendees.split(',').map(a => a.trim().split('@')[0]).join(', ') : 'team members';
                summary += `Call with ${attendeeList} from ${call.account}. `;
                
                // What was discussed based on Clari topics
                if (topics.length > 0) {
                    summary += `The conversation centered on: `;
                    const topicDescriptions = topics.map(t => {
                        const topicExplanations = {
                            'Process': `procurement and approval processes (${t.score} mentions) - discussing how to navigate internal workflows and get stakeholder buy-in`,
                            'Next Steps': `action items and follow-ups (${t.score} mentions) - defining clear next steps to move the deal forward`,
                            'Timing': `timeline and urgency (${t.score} mentions) - discussing deadlines, implementation schedules, and time constraints`,
                            'Pricing': `commercial terms and pricing (${t.score} mentions) - negotiating costs, contract terms, and investment details`,
                            'Competition': `competitive landscape (${t.score} mentions) - customer is evaluating multiple vendors and comparing solutions`,
                            'Customer Goals Pain Points': `customer needs and challenges (${t.score} mentions) - uncovering pain points, business problems, and desired outcomes`,
                            'Budget': `budget and funding (${t.score} mentions) - discussing financial approval, budget allocation, and ROI justification`,
                            'Authority': `decision-making authority (${t.score} mentions) - identifying key stakeholders and who has approval power`
                        };
                        return topicExplanations[t.name] || `${t.name} (${t.score} mentions)`;
                    });
                    summary += topicDescriptions.slice(0, 3).join('; ') + '. ';
                }
                
                // Engagement quality
                if (call.engagingQuestions >= 6) {
                    summary += `Strong discovery approach with ${call.engagingQuestions} engaging questions asked by the rep. `;
                } else if (call.engagingQuestions >= 3) {
                    summary += `Moderate engagement with ${call.engagingQuestions} questions asked. `;
                } else if (call.engagingQuestions > 0) {
                    summary += `Limited discovery - only ${call.engagingQuestions} questions asked. Rep should probe deeper into customer pain and business impact. `;
                }
                
                // Talk/listen balance
                if (call.talkListenRatio >= 40 && call.talkListenRatio <= 60) {
                    summary += `Well-balanced conversation with ${call.talkListenRatio}% rep talk time - good two-way dialogue. `;
                } else if (call.talkListenRatio > 70) {
                    summary += `Rep-dominated conversation (${call.talkListenRatio}% talk time) - customer may not have had enough time to express needs. `;
                } else if (call.talkListenRatio < 30) {
                    summary += `Rep talked only ${call.talkListenRatio}% of the time - may need to lead the conversation more. `;
                }
                
                // Deal progression
                if (call.stageProgression === 'Advanced') {
                    summary += `✅ POSITIVE OUTCOME: Deal successfully advanced from ${call.dealStageBefore} to ${call.dealStageAfter}. This call moved the opportunity forward. `;
                } else if (call.stageProgression === 'Regressed') {
                    summary += `⚠️ CONCERN: Deal moved backward from ${call.dealStageBefore} to ${call.dealStageAfter}. This indicates potential issues or lost momentum that need addressing. `;
                } else if (call.dealStageAfter) {
                    summary += `Deal remains in ${call.dealStageAfter} stage - no progression during this call. `;
                }
                
                // Value-selling assessment
                if (call.valueSelling.maturity === 'Master') {
                    summary += `🌟 EXEMPLARY value-based selling demonstrated - use this call as a training example.`;
                } else if (call.valueSelling.maturity === 'Proficient') {
                    summary += `Good value-based approach, with room to deepen discovery and quantify business impact more.`;
                } else if (call.valueSelling.maturity === 'Developing') {
                    summary += `Some value patterns present, but needs more focus on quantifying ROI and connecting to business outcomes.`;
                } else if (call.valueSelling.maturity === 'Needs Coaching') {
                    summary += `⚠️ RED FLAG: Call relied on compliance/feature selling instead of value-based approach. Coaching needed on discovery and business impact.`;
                } else {
                    summary += `Transactional conversation focused on product/features without sufficient discovery of customer pain points or business value discussion.`;
                }
                
                return summary;
            };

            const handleUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setLoading(true);
                setError(null);

                try {
                    const text = await file.text();
                    
                    Papa.parse(text, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            const processed = results.data
                                .filter(row => row['Call title'] || row['Account Name'])
                                .map((row, idx) => {
                                    const textAnalysis = [row['Call title'] || '', row['Account Name'] || '', row['Opportunity Name'] || ''].join(' ');
                                    const vs = analyzeText(textAnalysis);
                                    const topics = getTopics(row);

                                    return {
                                        id: idx,
                                        callTitle: row['Call title'] || 'Unknown',
                                        account: row['Account Name'] || 'Unknown',
                                        repName: row['Rep Name'] || 'Unknown Rep',
                                        callLink: row['Call Link'] || '',
                                        durationMinutes: Math.round((row['Duration (in Seconds)'] || 0) / 60),
                                        talkListenRatio: row['Talk/listen ratio (%)'] || 0,
                                        engagingQuestions: row['Engaging questions'] || 0,
                                        dealStageBefore: row['Deal Stage before Call'] || '',
                                        dealStageAfter: row['Deal Stage after Call'] || '',
                                        attendees: row['Joined Attendees'] || '',
                                        valueSelling: vs,
                                        clariTopics: topics,
                                        coachingInsights: getCoachingInsights(vs, {
                                            engagingQuestions: row['Engaging questions'] || 0,
                                            talkListenRatio: row['Talk/listen ratio (%)'] || 0,
                                            stageProgression: (() => {
                                            const b = row['Deal Stage before Call'];
                                            const a = row['Deal Stage after Call'];
                                            if (!b || !a || b === a) return 'No Change';
                                            const stages = ['Discovery', 'Qualification', 'Proposal', 'Negotiation', 'Closed Won'];
                                            const bi = stages.findIndex(s => b.includes(s));
                                            const ai = stages.findIndex(s => a.includes(s));
                                            if (bi < ai) return 'Advanced';
                                            if (bi > ai) return 'Regressed';
                                            return 'Changed';
                                        })()
                                    };
                                });

                            if (processed.length === 0) {
                                setError('No valid data found');
                                setLoading(false);
                                return;
                            }

                            setData(processed);
                            
                            const total = processed.length;
                            const avgScore = processed.reduce((sum, r) => sum + r.valueSelling.totalScore, 0) / total;
                            const matDist = {};
                            processed.forEach(r => { matDist[r.valueSelling.maturity] = (matDist[r.valueSelling.maturity] || 0) + 1; });
                            
                            const repPerf = {};
                            processed.forEach(r => {
                                if (!repPerf[r.repName]) repPerf[r.repName] = { calls: 0, totalScore: 0, scores: [], master: 0, proficient: 0, developing: 0, transactional: 0, coaching: 0 };
                                repPerf[r.repName].calls++;
                                repPerf[r.repName].totalScore += r.valueSelling.totalScore;
                                repPerf[r.repName].scores.push(r.valueSelling.totalScore);
                                const m = r.valueSelling.maturity;
                                if (m === 'Master') repPerf[r.repName].master++;
                                else if (m === 'Proficient') repPerf[r.repName].proficient++;
                                else if (m === 'Developing') repPerf[r.repName].developing++;
                                else if (m === 'Transactional') repPerf[r.repName].transactional++;
                                else if (m === 'Needs Coaching') repPerf[r.repName].coaching++;
                            });
                            
                            Object.keys(repPerf).forEach(rep => {
                                repPerf[rep].avgScore = Math.round(repPerf[rep].totalScore / repPerf[rep].calls);
                            });
                            
                            setAnalysis({
                                overview: {
                                    total,
                                    avgScore: Math.round(avgScore),
                                    masterCallsCount: processed.filter(r => r.valueSelling.maturity === 'Master').length,
                                    highValueCount: processed.filter(r => r.valueSelling.totalScore >= 5).length,
                                    needsCoachingCount: processed.filter(r => r.valueSelling.maturity === 'Needs Coaching').length
                                },
                                maturityDistribution: matDist,
                                topPerformers: [...processed].sort((a, b) => b.valueSelling.totalScore - a.valueSelling.totalScore).slice(0, 20),
                                repPerformance: repPerf
                            });
                            
                            setLoading(false);
                        }
                    });
                } catch (err) {
                    setError('Error: ' + err.message);
                    setLoading(false);
                }
            };

            const getMaturityColor = (m) => {
                if (m === 'Master') return 'bg-green-100 text-green-800 border-green-300';
                if (m === 'Proficient') return 'bg-blue-100 text-blue-800 border-blue-300';
                if (m === 'Developing') return 'bg-yellow-100 text-yellow-800 border-yellow-300';
                if (m === 'Needs Coaching') return 'bg-red-100 text-red-800 border-red-300';
                return 'bg-gray-100 text-gray-800 border-gray-300';
            };

            if (!data || !analysis) {
                return (
                    <div className="min-h-screen bg-gray-50 p-8">
                        <div className="max-w-7xl mx-auto">
                            <div className="bg-white rounded-lg shadow-lg p-8">
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-8 h-8 text-blue-600"><Award /></div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-900">Anaconda Sales Intelligence</h1>
                                        <p className="text-gray-600">Upload your Clari CSV file to analyze call quality</p>
                                    </div>
                                </div>

                                {error && (
                                    <div className="mb-4 p-4 bg-red-50 border-l-4 border-red-500 rounded">
                                        <p className="text-sm text-red-800">{error}</p>
                                    </div>
                                )}

                                <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer">
                                    <input type="file" accept=".csv" onChange={handleUpload} className="hidden" id="upload" />
                                    <label htmlFor="upload" className="cursor-pointer">
                                        <div className="w-16 h-16 text-gray-400 mx-auto mb-4"><Upload /></div>
                                        <p className="text-xl font-medium text-gray-700 mb-2">Upload CSV File</p>
                                        <p className="text-sm text-gray-500">Click to browse or drag and drop</p>
                                    </label>
                                </div>

                                {loading && (
                                    <div className="mt-8 text-center animate-pulse">
                                        <div className="w-12 h-12 text-blue-600 mx-auto mb-4"><BarChart /></div>
                                        <p className="text-gray-600">Analyzing calls...</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            const CallCard = ({ call, idx }) => {
                const expanded = expandedCall === idx;
                const info = maturityInfo[call.valueSelling.maturity];

                return (
                    <div className="border-2 border-blue-200 rounded-lg p-4 bg-white mb-3">
                        <div className="flex justify-between items-start mb-2">
                            <div className="flex-1">
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="text-lg font-bold text-blue-600">#{idx + 1}</span>
                                    <p className="font-semibold text-gray-900">{call.account}</p>
                                </div>
                                <p className="text-sm text-gray-600">{call.callTitle}</p>
                                <p className="text-xs text-gray-500">Rep: {call.repName}</p>
                            </div>
                            <div className="text-right">
                                <span className="text-2xl font-bold text-green-600">{call.valueSelling.totalScore}</span>
                                <p className="text-xs text-gray-600">score</p>
                            </div>
                        </div>

                        <div className="flex items-center gap-2 mb-3 flex-wrap">
                            <span className={`px-3 py-1 rounded-full text-xs font-medium ${getMaturityColor(call.valueSelling.maturity)}`}>
                                {info.icon} {call.valueSelling.maturity}
                            </span>
                            {call.durationMinutes > 0 && (
                                <span className="px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-800">
                                    <Clock className="w-3 h-3 inline mr-1" />{call.durationMinutes} min
                                </span>
                            )}
                            {call.stageProgression !== 'No Change' && (
                                <span className={`px-2 py-1 rounded-full text-xs ${call.stageProgression === 'Advanced' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                    {call.stageProgression}
                                </span>
                            )}
                        </div>

                        <div className="mb-3 p-3 bg-blue-50 rounded">
                            <p className={`text-xs font-semibold ${info.color} mb-1`}>
                                <Info className="w-3 h-3 inline mr-1" />What "{call.valueSelling.maturity}" means:
                            </p>
                            <p className="text-xs text-gray-700">{info.description}</p>
                        </div>

                        <button onClick={() => setExpandedCall(expanded ? null : idx)} className="w-full text-left p-3 bg-blue-50 rounded hover:bg-blue-100">
                            <div className="flex items-center justify-between">
                                <span className="text-sm font-medium text-blue-900">📋 Detailed Call Summary</span>
                                {expanded ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />}
                            </div>
                        </button>

                        {expanded && (
                            <div className="mt-3 p-4 bg-gray-50 rounded space-y-4">
                                <div className="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-300">
                                    <p className="text-sm font-bold text-blue-900 mb-2">📝 QUICK SUMMARY:</p>
                                    <p className="text-sm text-gray-900 leading-relaxed mb-3">{getSummary(call)}</p>
                                    
                                    {call.valueSelling.totalScore === 0 && (
                                        <div className="mt-3 p-3 bg-yellow-50 rounded border border-yellow-300">
                                            <p className="text-xs font-semibold text-yellow-900 mb-1">ℹ️ Why is the score 0?</p>
                                            <p className="text-xs text-gray-700">
                                                CSV files only contain call titles and metadata - not the actual conversation. 
                                                The scoring looks for value-selling language like "what does it cost you?", "ROI", "efficiency gains", etc. 
                                                If the call title doesn't contain these phrases, the score will be low. 
                                                For better analysis, use the full call transcript or Clari's conversation intelligence data.
                                            </p>
                                        </div>
                                    )}
                                </div>

                                {call.coachingInsights.length > 0 && (
                                    <div className="p-3 bg-yellow-50 rounded border-l-4 border-yellow-500">
                                        <p className="text-xs font-semibold text-yellow-900 mb-2">💡 COACHING INSIGHTS:</p>
                                        {call.coachingInsights.map((ins, i) => (
                                            <p key={i} className="text-sm text-gray-900 mb-1">• {ins}</p>
                                        ))}
                                    </div>
                                )}

                                {call.clariTopics.length > 0 && (
                                    <div className="p-3 bg-white rounded border border-gray-200">
                                        <p className="text-xs font-semibold text-gray-700 mb-3">🤖 Topics Discussed (Clari AI Analysis):</p>
                                        <div className="space-y-2">
                                            {call.clariTopics.map((t, i) => {
                                                const explanations = {
                                                    'Process': 'Procurement processes, approval workflows, and how to navigate internal stakeholder alignment',
                                                    'Next Steps': 'Action items, follow-up tasks, and commitments made to advance the deal',
                                                    'Timing': 'Timeline requirements, deadlines, urgency factors, and implementation schedules',
                                                    'Pricing': 'Commercial terms, pricing discussion, contract negotiations, and investment details',
                                                    'Competition': 'Competitive landscape - customer is evaluating multiple vendors and comparing solutions',
                                                    'Customer Goals Pain Points': 'Customer business challenges, pain points, desired outcomes, and what success looks like',
                                                    'Budget': 'Budget allocation, funding sources, financial approval processes, and ROI justification',
                                                    'Authority': 'Decision-makers, stakeholders involved, and who has approval authority',
                                                    'Agenda Setting': 'Meeting structure and objectives established at the beginning of the call'
                                                };
                                                return (
                                                    <div key={i} className="p-2 bg-blue-50 rounded">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className="px-2 py-1 bg-blue-600 text-white rounded text-xs font-bold">
                                                                {t.score} mentions
                                                            </span>
                                                            <span className="font-semibold text-sm text-gray-900">{t.name}</span>
                                                        </div>
                                                        <p className="text-xs text-gray-600 ml-2">
                                                            {explanations[t.name] || 'Discussion point identified by Clari AI'}
                                                        </p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {call.dealStageAfter && (
                                    <div className="p-3 bg-white rounded border border-gray-200">
                                        <p className="text-xs font-semibold text-gray-700 mb-1">📈 Deal Progression:</p>
                                        <p className="text-sm text-gray-900">
                                            {call.dealStageBefore === call.dealStageAfter 
                                                ? `Remained in ${call.dealStageAfter}` 
                                                : `${call.dealStageBefore} → ${call.dealStageAfter}`}
                                        </p>
                                    </div>
                                )}

                                {call.engagingQuestions > 0 && (
                                    <div className="p-3 bg-white rounded border border-gray-200">
                                        <p className="text-xs font-semibold text-gray-700 mb-1">💬 Engagement:</p>
                                        <p className="text-sm text-gray-900">
                                            {call.engagingQuestions} questions • {call.talkListenRatio}% talk/listen ratio
                                        </p>
                                    </div>
                                )}

                                {call.attendees && (
                                    <div className="p-3 bg-white rounded border border-gray-200">
                                        <p className="text-xs font-semibold text-gray-700 mb-1">👥 Attendees:</p>
                                        <p className="text-xs text-gray-600">{call.attendees}</p>
                                    </div>
                                )}

                                <div className="p-3 bg-purple-50 rounded border-l-4 border-purple-500">
                                    <p className="text-xs font-semibold text-purple-900 mb-2">✨ Value Patterns Detected in Call Title/Metadata:</p>
                                    {Object.entries(call.valueSelling.patterns).filter(([_, p]) => p.count > 0).length > 0 ? (
                                        <div className="space-y-2">
                                            {Object.entries(call.valueSelling.patterns)
                                                .filter(([_, p]) => p.count > 0)
                                                .map(([key, p]) => (
                                                    <div key={key} className={`p-2 rounded ${p.isNegative ? 'bg-red-50 border border-red-200' : 'bg-white border border-green-200'}`}>
                                                        <div className="flex justify-between mb-1">
                                                            <span className={`text-xs font-medium ${p.isNegative ? 'text-red-800' : 'text-green-800'}`}>
                                                                {p.isNegative ? '⚠️' : '✓'} {p.name} ({p.count})
                                                            </span>
                                                            <span className={`text-xs font-bold ${p.isNegative ? 'text-red-600' : 'text-green-600'}`}>
                                                                {p.score > 0 ? '+' : ''}{p.score} pts
                                                            </span>
                                                        </div>
                                                        <p className="text-xs text-gray-600 mb-1">{p.explanation}</p>
                                                        {p.matchedKeywords && p.matchedKeywords.length > 0 && (
                                                            <div className="mt-1">
                                                                <p className="text-xs text-gray-600 mb-1">Detected phrases:</p>
                                                                <div className="flex flex-wrap gap-1">
                                                                    {p.matchedKeywords.map((kw, i) => (
                                                                        <span key={i} className={`px-2 py-0.5 rounded text-xs ${p.isNegative ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>
                                                                            "{kw}"
                                                                        </span>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                        </div>
                                    ) : (
                                        <div className="p-3 bg-gray-50 rounded border border-gray-200">
                                            <p className="text-xs text-gray-700 mb-2">
                                                ⚠️ No value-selling language detected in the call title or metadata.
                                            </p>
                                            <p className="text-xs text-gray-600">
                                                <strong>Note:</strong> CSV exports only contain call titles, not the full conversation. 
                                                This call may have excellent value-selling in the actual recording, but it's not reflected in the metadata. 
                                                The Clari topics above show what WAS discussed - use those insights along with the engagement metrics.
                                            </p>
                                            <p className="text-xs text-blue-600 mt-2">
                                                💡 Click "View Recording" below to listen and assess value-selling quality directly.
                                            </p>
                                        </div>
                                    )}
                                </div>

                                {call.callLink && (
                                    <a href={call.callLink} target="_blank" className="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">
                                        🎥 View Recording
                                    </a>
                                )}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-50 p-8">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 text-blue-600"><Award /></div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-900">Anaconda Sales Intelligence</h1>
                                        <p className="text-sm text-gray-600">{data.length} calls • Avg Score: <span className="font-bold text-blue-600">{analysis.overview.avgScore}</span></p>
                                    </div>
                                </div>
                                <button onClick={() => { setData(null); setAnalysis(null); }} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm font-medium">Upload New</button>
                            </div>
                            
                            {analysis.overview.avgScore === 0 && (
                                <div className="mt-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
                                    <p className="text-xs font-semibold text-blue-900 mb-1">ℹ️ About the Scoring:</p>
                                    <p className="text-xs text-gray-700">
                                        CSV exports contain limited text (call titles only). Scores are based on value-selling phrases in titles like "discovery", "ROI discussion", "efficiency review", etc. 
                                        Use the <strong>Clari Topics, Engagement metrics, and Deal Progression</strong> below for call quality insights. 
                                        For detailed value-selling analysis, review the actual call recordings.
                                    </p>
                                </div>
                            )}
                        </div>

                        <div className="grid grid-cols-4 gap-6 mb-6">
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-green-600"><Star /></div>
                                    <span className="text-sm text-gray-600">Master Calls</span>
                                </div>
                                <p className="text-3xl font-bold text-gray-900">{analysis.overview.masterCallsCount}</p>
                                <p className="text-xs text-gray-500 mt-1">{((analysis.overview.masterCallsCount / analysis.overview.total) * 100).toFixed(1)}%</p>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-purple-600"><Target /></div>
                                    <span className="text-sm text-gray-600">High-Value</span>
                                </div>
                                <p className="text-3xl font-bold text-gray-900">{analysis.overview.highValueCount}</p>
                                <p className="text-xs text-gray-500 mt-1">{((analysis.overview.highValueCount / analysis.overview.total) * 100).toFixed(1)}%</p>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-red-600"><ThumbsDown /></div>
                                    <span className="text-sm text-gray-600">Needs Coaching</span>
                                </div>
                                <p className="text-3xl font-bold text-gray-900">{analysis.overview.needsCoachingCount}</p>
                                <p className="text-xs text-gray-500 mt-1">{((analysis.overview.needsCoachingCount / analysis.overview.total) * 100).toFixed(1)}%</p>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-5 h-5 text-blue-600"><BarChart /></div>
                                    <span className="text-sm text-gray-600">Avg Score</span>
                                </div>
                                <p className="text-3xl font-bold text-blue-600">{analysis.overview.avgScore}</p>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow mb-6 p-2">
                            <div className="flex gap-2">
                                {['overview', 'allCalls', 'topCalls', 'reps'].map(view => (
                                    <button key={view} onClick={() => setActiveView(view)} className={`px-4 py-2 rounded ${activeView === view ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'}`}>
                                        {view === 'allCalls' ? 'All Calls' : view === 'topCalls' ? 'Top Calls' : view === 'reps' ? '🏆 Reps' : 'Overview'}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {activeView === 'overview' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Maturity Distribution</h3>
                                <div className="grid grid-cols-5 gap-4">
                                    {Object.entries(analysis.maturityDistribution).map(([mat, count]) => {
                                        const info = maturityInfo[mat];
                                        return (
                                            <div key={mat} className={`rounded-lg p-4 border-2 ${getMaturityColor(mat)}`}>
                                                <p className="text-sm font-medium mb-1">{info.icon} {mat}</p>
                                                <p className="text-3xl font-bold">{count}</p>
                                                <p className="text-xs mt-1">{((count / analysis.overview.total) * 100).toFixed(1)}%</p>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {activeView === 'allCalls' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">All Calls with Summaries</h3>
                                {data.map((call, idx) => <CallCard key={idx} call={call} idx={idx} />)}
                            </div>
                        )}

                        {activeView === 'topCalls' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Top 20 Calls by Score</h3>
                                {analysis.topPerformers.map((call, idx) => <CallCard key={idx} call={call} idx={idx} />)}
                            </div>
                        )}

                        {activeView === 'reps' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">🏆 Rep Performance</h3>
                                {Object.entries(analysis.repPerformance)
                                    .sort((a, b) => b[1].avgScore - a[1].avgScore)
                                    .map(([rep, stats], idx) => (
                                        <div key={rep} className="border-2 border-gray-200 rounded-lg p-4 mb-3">
                                            <div className="flex justify-between mb-3">
                                                <div>
                                                    <span className="text-lg font-bold text-blue-600">#{idx + 1}</span>
                                                    <span className="ml-2 font-semibold text-gray-900">{rep}</span>
                                                    <p className="text-xs text-gray-500">{stats.calls} calls</p>
                                                </div>
                                                <div className="text-right">
                                                    <span className="text-3xl font-bold text-blue-600">{stats.avgScore}</span>
                                                    <p className="text-xs text-gray-600">avg score</p>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-5 gap-2">
                                                <div className="bg-green-50 rounded p-2 text-center">
                                                    <p className="text-xs text-gray-600">Master</p>
                                                    <p className="text-lg font-bold text-green-600">{stats.master}</p>
                                                </div>
                                                <div className="bg-blue-50 rounded p-2 text-center">
                                                    <p className="text-xs text-gray-600">Proficient</p>
                                                    <p className="text-lg font-bold text-blue-600">{stats.proficient}</p>
                                                </div>
                                                <div className="bg-yellow-50 rounded p-2 text-center">
                                                    <p className="text-xs text-gray-600">Developing</p>
                                                    <p className="text-lg font-bold text-yellow-600">{stats.developing}</p>
                                                </div>
                                                <div className="bg-gray-50 rounded p-2 text-center">
                                                    <p className="text-xs text-gray-600">Transact.</p>
                                                    <p className="text-lg font-bold text-gray-600">{stats.transactional}</p>
                                                </div>
                                                <div className="bg-red-50 rounded p-2 text-center">
                                                    <p className="text-xs text-gray-600">Coaching</p>
                                                    <p className="text-lg font-bold text-red-600">{stats.coaching}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>